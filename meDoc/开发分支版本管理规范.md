# 开发分支版本管理规范

创建日期：2016/06/12

更新日期：2016/06/12

##目的

规范研发代码分支管理，提升开发效率、降低代码管理成本及发版时造成的质量风险。

##适用范围

后端开发代码

##名词解释

|名词				|解释说明
|临时分支			|为了某个需求或某个版本创建的分支，上线后可被删除的代码分支；
|永恒分支			|常久保留的代码分支，不会被分支版本管理员清除的代码分支；
|BUG				|不满足产品需求的缺陷；
|Release_X			|此为小集成分支命名；
|Release			|此为大集成分支命名；

##分支命名

后端代码分类根据不同可分为以下几类分支:

**1、特性分支**

特性分支为具体需求的开发的临时分支；

此分支为develop分支基础上开发新需求的代码所在的分支，用于开发调试、测试的迭代测试；

此分支测试通过并初审通过后方可合并至集成分支Release;

此分支命名规则为：PM/PD-VXXXX-***;

PM代表产品需求，PD代表技术需求或非紧急BUG；VXXXX表示此需求所属的需求版本号；***表示大致描述

**2、开发分支develop**

开发分支develop为永恒分支；

开发同步代码的源分支，此为分支用于开发人员的基础代码分支；

特性分支都在此分支衍生而成，此分支的源分支为Master分支，通过同步Master分支来更新分支代码；

**3、小集成分支release_x**

小集成分支release_x为永恒分支；

当处于多项目同时进行时x表达项目编号1、2、3等（如web前台1，web后台2等），此为小集成分支用于合并各项目（根据项目不同使用不同小集成release_1,release_2...）迭代测试通过且将发布的代码分支

此分支为冻结项目需求分支，达到约定点的需求；此分支小集成验证通过后，向大集成分支release合并，仅当只有一个项目在规定的时间通过小集成测试时，可直接合并至发布分支master

当小集成测试不通过时，需要从此分支拉出一条小集成修复分支rel_XFix用于开发修复小集成BUG

**4、小集成修复分支rel_XFix**

小集成修复分支为临时分支，是从release_X分支拉出的分支，当release_x分支验证不通过时，则BUG修复在此分支上修复，直至小集成测试通过方可合并至release_x分支；此分支的源分支和目标分支都是release_x分支；

**5、大集成分支release**

大集成分支为永恒分支；是用于合并小集成测试通过并通过终审通过的小集成分支release_x;

此分支可在预发布环境上进行验证；此分支为冻结版本需求分支，到达约定的时间点的需求；release应有版本号，版本号按ZB_YYYYMMDDHH来确定；

**6、集成修复分支relFix**

大集成修复分支为临时分支，是从release分支拉出的分支，当release分支验证不通过时，则BUG修复在此分支上修复，直至集成测试通过方可合并至release分支；此分支的源分支和目标分支都是release分支；

**7、发布分支master**

此分支为永恒分支，到达此分支的代码都是经过迭代测试、初审、集成测试并且通过的代码；此分支主要用于发布版本，版本发布只能从此分支上操作，是唯一的可发版的分支；此分支的源分支为release和hotFix分支，此分支无目标分支，为合并的最终分支；master应有版本号，版本号按ZB_YYYYMMDDHH来确定；

**8、线上修复分支hostfix**

此分支为临时分支，主要用于解决线上紧急BUG的修复或紧急版本的发布从master中同步代码生成的临时分支，此分支的源分支和目标分支都是也必须进过迭代测试和集成测试验证，测试过程中发现的BUG也是在分支上修复；在迭代、初审、集成通过后方可合并至master分支；此分支的集成测试环境为预发布环境；

##分支流程

##分支管理

分支管理原则如下：

1、永恒分支只有版本管理员有合并分支权限，其他人员只有从永恒分支拉去代码的权限；

2、开发的特性分支是从develop拉代码；集成BUG修改时从相应的集成分支拉代码；线上问题修复时是从master分支拉代码；开发每天需要到相应的分支同步代码以减少冲突；

3、特性分支提测前必须附带工程信息，以便后续版本管理查阅

4、临时分支的内容上线后需要定期清理，分支版本管理员每隔2个月清理一次临时分支；

5、合并至发布分支master上时必须将master的最新代码同步到开发分支develop、集成分支release_x和release;

6、有依赖关系的功能必须在同一个特性分支；特性分支由开发人员创建；提测时注明；

7、进入release_x分支条件是代码初审通过、迭代测试通过并且计划项目中发布的功能；

8、rel_XFix分支的Bug修复根据实际情况分别在测试环境、继承测试环境上验证；

9、代码进入release分支条件是代码初审通过、迭代测试、小集成测试通过并且计划版本发布的功能；

10、relFix分支的BUG修复可根据实际情况分为测试环境和预发布环境上进行验证；

11、代码进入master分支条件是代码审核通过、迭代测试通过、集成测试通过且属于计划版本中的功能；

12、hotFix分支代码必须经过代码初审通过、迭代测试通过、集成测试通过方可合并至master分支；此分支的集成测试环境为预发布环境；

13、特性分支提测前必须通过代码初审方可提测；小集成分支测试完成后必须通过代码终审方可进入大集成分支release测试或合并发布分支master；

14、所有分支的代码合并冲突由开发人员解决，未在规定的时间内解决冲突版本管理员可不合并此特性分支代码；

15、特性分支已合并到了release分支，就可以与其他特性分支合并，但提测时必须说明

16、分支合并请求格式：

##版本发布

发版原则如下：

1、节假日前一天工作日不发版，用户高峰时间不发版；（19：00~23：00）

2、发版前一天17：00开始代码合并工作到集成分支，并在下班前完成集成测试环境部署；在17：00未通过迭代测试的功能需求不合入集成分支；



